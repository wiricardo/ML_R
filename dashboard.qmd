---
title: "Dashboard Modelos de Machine Learning"
format: dashboard
server: shiny
theme: united
---

```{r}
#| context: setup

library(tidyverse)
library(plotly)
library(ggthemes)
library(rio)
library(shiny)
library(ggplot2)
library(naniar)

data <- import('Mall_Customers_Enhanced.csv')

## data filtrada
est_vars <- data |> select(`Credit Score`, `Annual Income (k$)`, `Preferred Category`, `Estimated Savings (k$)`) |> 
  as_tibble(rownames = 'Estadístico')


# carga de plots desempeño de los modelos
m1_plot <- readRDS(file = "m1_plot.rds")
m2_plot <- readRDS(file = "m2_plot.rds")
m3_plot <- readRDS(file = "m3_plot.rds")
rf_plot <- readRDS(file = "rf_plot.rds")

# carga de metricas

m1_metrics <- readRDS(file = "m1_metrics.rds")
m2_metrics <- readRDS(file = "m2_metrics.rds")
m3_metrics <- readRDS(file = "m3_metrics.rds")
rf_metrics <- readRDS(file = "rf_metrics.rds")



```

# Customer Analytics

**Objetivos**

Analizar cómo el ingreso anual, la categoría de preferencia y el ahorro estimado influyen en el puntaje crediticio de los clientes mediante tres modelos de regresión lineal. Se busca identificar qué variables explican mejor las variaciones en el Credit Score y aportar evidencia para la segmentación de clientes en contextos financieros y de consumo.

**Justificación del dataset**

El dataset *Mall Customers* fue elegido por su carácter educativo y su estructura realista, ya que combina variables demográficas, financieras y de comportamiento de compra. Esta diversidad permite desarrollar modelos predictivos más robustos y analizar relaciones significativas entre los hábitos de consumo y el perfil crediticio.

**Público objetivo**

El estudio está orientado a analistas de datos, profesionales de marketing y entidades financieras interesadas en comprender los factores que determinan el puntaje crediticio y en diseñar estrategias personalizadas de fidelización o gestión de riesgo.


**Problemática**

-   ¿Cómo influyen el ingreso anual, la categoría de preferencia y el ahorro estimado en el puntaje crediticio de los clientes?

A partir del dataset ampliado *Mall Customers*, se desarrollaron tres modelos de regresión lineal para determinar qué factores explican mejor las variaciones en el Credit Score y para analizar los patrones asociados al comportamiento financiero de los consumidores.

**Descripción de las variables**

-   **Credit Score:** indicador numérico que refleja la solvencia financiera del cliente y su comportamiento frente al crédito.
-   **Annual Income (k\$):** nivel de ingreso anual expresado en miles de dólares, relacionado con la capacidad económica del cliente.
-   **Estimated Savings (k\$):** monto estimado de ahorro calculado a partir de los ingresos y patrones de gasto.
-   **Preferred Category:** tipo de productos o servicios que el cliente prefiere adquirir, clasificado en categorías como *Luxury*, *Budget*, *Fashion* o *Electronics*.



# EDA

## Row {height=30%}
```{r}

plotOutput("nulos")

```

```{r}

plotOutput("cat")

```

## Row

```{r}
plotOutput("var1")
```

## Row

```{r}
plotOutput("var2")
```

# Modelos de Regresion Lineal

La variable objetivo es **Credit Score**

## Row

**Modelo 1**

Usamos solo **Annual Income (k\$)** como predictor

- Existe una relación positiva moderada entre el ingreso anual y la variable objetivo (R² = 0.60).

- Sin embargo, los errores de predicción son amplios (RMSE ≈ 96), especialmente para valores altos.

- El modelo subestima o sobreestima varios casos, lo que indica que el ingreso anual no explica completamente la variabilidad de la variable dependiente.


```{r}

plotOutput("model_1")


```

```{r}
tableOutput("m1_metrics")
```


## Row

**Modelo 2**

Usamos **Annual Income (k\$)** y **Estimated Savings (k\$)** como predictores


- Existe una relación positiva moderada entre el ingreso anual y los ahorros estimados con la variable objetivo (R² = 0.62).

- Los errores de predicción son amplios (RMSE ≈ 93), sobre todo en valores altos del rango.

- El modelo tiende a subestimar o sobreestimar varios casos, lo que sugiere que los ingresos y los ahorros estimados no explican completamente la variabilidad de la variable dependiente.


```{r}
plotOutput("model_2")
```

```{r}
tableOutput("m2_metrics")
```


## Row

**Modelo 3**

Usamos **Annual Income (k\$)**, **Estimated Savings (k\$)** y **Preferred Category** (*variable categórica*) como predictores

- La inclusión de la variable categórica Preferred Category mejora el ajuste del modelo (R² = 0.75), lo que indica una relación positiva más fuerte con la variable objetivo.

- El error promedio disminuye (RMSE ≈ 80), de esta forma las predicciones más algo mas precisas que en los modelos anteriores.

- Aunque el patrón general sigue una tendencia lineal, persisten algunos casos subestimados y sobrestimados, especialmente en valores altos.


```{r}
plotOutput("model_3")
```


```{r}
tableOutput("m3_metrics")
```




# Random Forest

## Row

Usamos el **Modelo 3** para ser *mejorado*

- Al aplicar Random Forest sobre las mismas variables del Modelo 3, el desempeño mejora notablemente (R² = 0.94).

- El error de predicción se reduce considerablemente (RMSE ≈ 40), indicando un ajuste mucho más preciso.

- Los valores predichos se alinean estrechamente con los reales.

- Random Forest maneja mejor la variabilidad y posibles interacciones entre variables, de esta forma tiene mejor desempeño que el modelo lineal.

```{r}
plotOutput("rf_model")
```


```{r}
tableOutput("rf_metrics")
```




# Data

```{r}
#| title: Visualizacion del Data set Mall Custumers

tableOutput("data")
```


```{r}
#| context: server

# dataset de pagina principal
output$data <- renderTable({
  data
})



# plot de nulos | pestaña EDA
output$nulos <- renderPlot({
   vis_miss(est_vars)
})


# plot de histogramas

output$cat <- renderPlot({
  est_vars |> 
  ggplot(aes(x = `Preferred Category`)) +
  geom_bar(fill = "steelblue") +
  labs(
    title = "Distribución de Categorías Preferidas",
    x = "Categoría Preferida",
    y = "Frecuencia"
  ) +
  theme_minimal()
})

# plot de dispersion 1

output$var1 <- renderPlot({
  est_vars |> 
  ggplot(aes(x = `Annual Income (k$)`, 
             y = `Estimated Savings (k$)`)) +
  geom_point(color = "steelblue", size = 3, alpha = 0.7) +
  labs(
    title = "Relación entre Ingreso Anual y Ahorros Estimados",
    x = "Ingreso Anual (k$)",
    y = "Ahorros Estimados (k$)"
  ) +
  theme_minimal()

})

# plot de dispersion 2


output$var2 <- renderPlot({
  est_vars |> 
  ggplot(aes(x = `Annual Income (k$)`, 
             y = `Estimated Savings (k$)`,
             size = `Credit Score`)) +
  geom_point(color = "darkorange", alpha = 0.7) +
  labs(
    title = "Ingreso vs Ahorros (Tamaño = Credit Score)",
    x = "Ingreso Anual (k$)",
    y = "Ahorros Estimados (k$)",
    size = "Credit Score"
  ) +
  theme_minimal()

})


# plots de modelos

output$model_1 <- renderPlot({
  m1_plot
})

output$model_2 <- renderPlot({
  m2_plot
})

output$model_3 <- renderPlot({
  m3_plot
})


output$rf_model <- renderPlot({
  rf_plot
})



# metricas de modelos

output$m1_metrics <- renderTable({
  m1_metrics
})

output$m2_metrics <- renderTable({
  m2_metrics
})

output$m3_metrics <- renderTable({
  m3_metrics
})

output$rf_metrics <- renderTable({
  rf_metrics
})




```
